{"ast":null,"code":"var _jsxFileName = \"/home/alfredo_orquiz/projects/school/codefellows/courses/401/todo-app/src/context/auth.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/React.createContext();\nconst testUsers = {\n  admin: {\n    username: 'admin',\n    password: 'ADMIN',\n    email: 'admin.name@email.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZDFiMzNjZTQ5MDAxODlmMzhiNyIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIiwiZGVsZXRlIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA3OTMxLCJleHAiOjE2NTg5MTE1MzF9.bqe-52if5K50rGn30P4fheuAa2qWuxse9tWiuH4cnUM'\n  },\n  editor: {\n    username: 'editor',\n    password: 'EDITOR',\n    email: 'editor.name@email.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZjk5MzNjZTQ5MDAxODlmMzhiYSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NTY5LCJleHAiOjE2NTg5MTIxNjl9.073ppQCHbplYN9befn8JElcP4zgFX6TEe_ARUQZc0KU'\n  },\n  writer: {\n    username: 'writer',\n    password: 'WRITER',\n    email: 'writer.name@email.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZmUxMzNjZTQ5MDAxODlmMzhiZCIsImNhcGFiaWxpdGllcyI6W10sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NjQxLCJleHAiOjE2NTg5MTIyNDF9.AUOPHDRV6z8urvmgUOyRmCYUwfeScmGdb4ztvjPMlos'\n  },\n  user: {\n    username: 'user',\n    password: 'USER',\n    email: 'user.name@email.com',\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBmMGZjMzNjZTQ5MDAxODlmMzhjMCIsImNhcGFiaWxpdGllcyI6WyJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4OTI0LCJleHAiOjE2NTg5MTI1MjR9.t7c7k2LbaTxsdfYjx_WC3QiP4MycU8sZryVyXQqJQH'\n  }\n};\nfunction AuthProvider(_ref) {\n  _s();\n  let {\n    children\n  } = _ref;\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\n  let [user, setUser] = useState({});\n  let [error, setError] = useState(null);\n  const can = capability => {\n    var _user$capabilities;\n    return user === null || user === void 0 ? void 0 : (_user$capabilities = user.capabilities) === null || _user$capabilities === void 0 ? void 0 : _user$capabilities.includes(capability); // optional property reading\n  };\n\n  const login = async (username, password) => {\n    let authCreds = testUsers[username]; // make a request to our Remote Service.\n\n    if (authCreds && authCreds.password === password) {\n      try {\n        _validateToken(authCreds.token);\n        setUser(testUsers[username]);\n        setIsLoggedIn(true);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n  const _validateToken = token => {\n    try {\n      let validUser = jwt_decode(token);\n      if (validUser) {\n        setUser(validUser);\n        setIsLoggedIn(true);\n        cookie.save('auth', token);\n      }\n    } catch (e) {\n      setIsLoggedIn(false);\n      setError(e);\n    }\n  };\n  const logout = () => {\n    setUser({});\n    setIsLoggedIn(false);\n    setError(null);\n    cookie.remove('auth');\n  };\n  useEffect(() => {\n    let token = cookie.load('auth'); // loads any cookies stored under \"auth\"\n    // how can we validate our cookie token?\n  }, []);\n  const values = {\n    user,\n    can,\n    isLoggedIn,\n    login,\n    logout,\n    error\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: values,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"Mdj9vFz1QJyXrwSLHYdHoDZV/VU=\");\n_c = AuthProvider;\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","useState","useEffect","cookie","jwt_decode","AuthContext","createContext","testUsers","admin","username","password","email","token","editor","writer","user","AuthProvider","children","isLoggedIn","setIsLoggedIn","setUser","error","setError","can","capability","capabilities","includes","login","authCreds","_validateToken","e","console","validUser","save","logout","remove","load","values"],"sources":["/home/alfredo_orquiz/projects/school/codefellows/courses/401/todo-app/src/context/auth.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport cookie from 'react-cookies';\r\nimport jwt_decode from 'jwt-decode';\r\n\r\nexport const AuthContext = React.createContext();\r\n\r\nconst testUsers = {\r\n  admin: {\r\n    username: 'admin',\r\n    password: 'ADMIN',\r\n    email: 'admin.name@email.com',\r\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZDFiMzNjZTQ5MDAxODlmMzhiNyIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIiwiZGVsZXRlIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA3OTMxLCJleHAiOjE2NTg5MTE1MzF9.bqe-52if5K50rGn30P4fheuAa2qWuxse9tWiuH4cnUM',\r\n  },\r\n  editor: {\r\n    username: 'editor',\r\n    password: 'EDITOR',\r\n    email: 'editor.name@email.com',\r\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZjk5MzNjZTQ5MDAxODlmMzhiYSIsImNhcGFiaWxpdGllcyI6WyJjcmVhdGUiLCJ1cGRhdGUiLCJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NTY5LCJleHAiOjE2NTg5MTIxNjl9.073ppQCHbplYN9befn8JElcP4zgFX6TEe_ARUQZc0KU',\r\n  },\r\n  writer: {\r\n    username: 'writer',\r\n    password: 'WRITER',\r\n    email: 'writer.name@email.com',\r\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBlZmUxMzNjZTQ5MDAxODlmMzhiZCIsImNhcGFiaWxpdGllcyI6W10sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4NjQxLCJleHAiOjE2NTg5MTIyNDF9.AUOPHDRV6z8urvmgUOyRmCYUwfeScmGdb4ztvjPMlos',\r\n  },\r\n  user: {\r\n    username: 'user',\r\n    password: 'USER',\r\n    email: 'user.name@email.com',\r\n    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyZTBmMGZjMzNjZTQ5MDAxODlmMzhjMCIsImNhcGFiaWxpdGllcyI6WyJyZWFkIl0sInR5cGUiOiJ1c2VyIiwiaWF0IjoxNjU4OTA4OTI0LCJleHAiOjE2NTg5MTI1MjR9.t7c7k2LbaTxsdfYjx_WC3QiP4MycU8sZryVyXQqJQH',\r\n  }\r\n}\r\n\r\nfunction AuthProvider({ children }) {\r\n\r\n  let [isLoggedIn, setIsLoggedIn] = useState(false);\r\n  let [user, setUser] = useState({});\r\n  let [error, setError] = useState(null);\r\n\r\n  const can = (capability) => {\r\n    return user?.capabilities?.includes(capability); // optional property reading\r\n  }\r\n\r\n  const login = async (username, password) => {\r\n    let authCreds = testUsers[username]; // make a request to our Remote Service.\r\n\r\n    if (authCreds && authCreds.password === password) {\r\n      try {\r\n        _validateToken(authCreds.token);\r\n        setUser(testUsers[username]);\r\n        setIsLoggedIn(true);\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  const _validateToken = (token) => {\r\n    try {\r\n      let validUser = jwt_decode(token);\r\n      if (validUser) {\r\n        setUser(validUser);\r\n        setIsLoggedIn(true);\r\n        cookie.save('auth', token);\r\n      }\r\n    } catch (e) {\r\n      setIsLoggedIn(false);\r\n      setError(e);\r\n    }\r\n  }\r\n  \r\n  const logout = () => {\r\n    setUser({});\r\n    setIsLoggedIn(false);\r\n    setError(null);\r\n    cookie.remove('auth');\r\n  }\r\n  \r\n  useEffect(() => {\r\n    let token = cookie.load('auth'); // loads any cookies stored under \"auth\"\r\n    // how can we validate our cookie token?\r\n  }, [])\r\n  \r\n  \r\n  const values = {\r\n    user,\r\n    can,\r\n    isLoggedIn,\r\n    login,\r\n    logout,\r\n    error,\r\n  }\r\n  \r\n  return (\r\n    <AuthContext.Provider value={values}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport default AuthProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}